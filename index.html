<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Where Back - API í…ŒìŠ¤íŠ¸</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: 'Segoe UI', sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #000;
        color: #f5f5f5;
      }
      h1 {
        color: #ff6b35;
      }
      section {
        background: #1a1a1a;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 16px;
        border: 1px solid #ff6b35;
      }
      h2 {
        margin-top: 0;
        color: #ff6b35;
        font-size: 1rem;
      }
      button {
        padding: 8px 16px;
        margin: 4px;
        cursor: pointer;
        border: none;
        border-radius: 6px;
        background: #ff6b35;
        color: #000;
      }
      button:hover {
        background: #ff8c5a;
      }
      button.secondary {
        background: #2a2a2a;
        color: #ff6b35;
        border: 1px solid #ff6b35;
      }
      input,
      textarea {
        padding: 8px;
        margin: 4px;
        border-radius: 6px;
        border: 1px solid #ff6b35;
        background: #0a0a0a;
        color: #f5f5f5;
      }
      pre {
        background: #0a0a0a;
        padding: 12px;
        border-radius: 6px;
        overflow-x: auto;
        font-size: 12px;
        border: 1px solid #ff6b35;
      }
      .row {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }
      label {
        min-width: 80px;
      }
      p.note {
        font-size: 12px;
        color: #b8860b;
      }
    </style>
  </head>
  <body>
    <h1>Where Back API í…ŒìŠ¤íŠ¸</h1>
    <p class="note">
      â€» ë°±ì—”ë“œ(localhost:8080) ì‹¤í–‰ í›„, ì´ í˜ì´ì§€ë¥¼ Live Server ë“±ìœ¼ë¡œ
      http://127.0.0.1:5500 ì—ì„œ ì—´ì–´ì£¼ì„¸ìš”. (CORS/ì¿ í‚¤ ë™ì‘)
    </p>

    <section>
      <h2>ğŸ”§ ì„¤ì •</h2>
      <div class="row">
        <label>API Base</label>
        <input
          type="text"
          id="baseUrl"
          value="http://localhost:8080"
          style="width: 280px"
        />
        <label>JWT (í…ŒìŠ¤íŠ¸ìš©)</label>
        <input
          type="text"
          id="jwtToken"
          placeholder="Bearer ìƒëµí•˜ê³  í† í°ë§Œ"
          style="width: 200px"
        />
      </div>
    </section>

    <section>
      <h2>ğŸ” ì¸ì¦</h2>
      <div class="row">
        <button onclick="openKakaoLogin()">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ (ë¦¬ë‹¤ì´ë ‰íŠ¸)</button>
        <button class="secondary" onclick="getKakaoUrl()">
          ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ URL ì¡°íšŒ
        </button>
        <button class="secondary" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
      <p class="note">
        ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í›„ JWTê°€ ì¿ í‚¤ì— ì €ì¥ë©ë‹ˆë‹¤. ì•„ë˜ APIëŠ” credentials í¬í•¨
        ìš”ì²­ìœ¼ë¡œ ì¿ í‚¤ ìë™ ì „ì†¡.
      </p>
    </section>

    <section>
      <h2>ğŸ® ê²Œì„</h2>
      <div class="row">
        <button onclick="getWaitingRooms()">ëŒ€ê¸° ë°© ëª©ë¡</button>
        <button onclick="createRoom()">ë°© ìƒì„±</button>
        <input
          type="number"
          id="roomId"
          placeholder="ë°©ID"
          style="width: 60px"
        />
        <button onclick="getRoom()">ë°© ì¡°íšŒ</button>
        <button onclick="joinRoom()">ì°¸ê°€</button>
        <button onclick="leaveRoom()">í‡´ì¥</button>
        <button onclick="setReady()">ì¤€ë¹„</button>
        <button onclick="startGame()">ê²Œì„ ì‹œì‘</button>
      </div>
      <input
        type="text"
        id="roomName"
        placeholder="ë°© ì´ë¦„"
        value="í…ŒìŠ¤íŠ¸ë°©"
        style="width: 120px"
      />
    </section>

    <section>
      <h2>ğŸ“ ìœ„ì¹˜</h2>
      <div class="row">
        <button onclick="getNearbyMarkers()">ê·¼ì²˜ ë§ˆì»¤</button>
        <input
          type="number"
          id="lat"
          placeholder="ìœ„ë„"
          value="37.5665"
          step="0.0001"
          style="width: 100px"
        />
        <input
          type="number"
          id="lng"
          placeholder="ê²½ë„"
          value="126.9780"
          step="0.0001"
          style="width: 100px"
        />
        <input
          type="number"
          id="radius"
          placeholder="ë°˜ê²½(km)"
          value="0.5"
          step="0.1"
          style="width: 80px"
        />
      </div>
      <div class="row" style="margin-top: 8px">
        <button class="secondary" onclick="getRegions()">ì „ì²´ ì§€ì—­ ëª©ë¡</button>
      </div>
    </section>

    <section>
      <h2>ğŸ‘¤ ì‚¬ìš©ì</h2>
      <button onclick="getMe()">ë‚´ ì •ë³´ (/api/user/me)</button>
    </section>

    <section>
      <h2>ğŸ“¤ ì‘ë‹µ</h2>
      <pre id="output">ì—¬ê¸°ì— ì‘ë‹µì´ í‘œì‹œë©ë‹ˆë‹¤.</pre>
    </section>

    <script>
      const out = document.getElementById('output');
      const base = () =>
        document.getElementById('baseUrl').value.replace(/\/$/, '');
      const token = () => document.getElementById('jwtToken').value.trim();

      function opts(useCreds = true) {
        const o = { headers: {} };
        if (token()) o.headers['Authorization'] = 'Bearer ' + token();
        if (useCreds) o.credentials = 'include';
        return o;
      }

      function json(body) {
        if (typeof body === 'object') return JSON.stringify(body, null, 2);
        return body;
      }

      async function api(method, path, body) {
        try {
          const options = { ...opts(), method };
          if (body) {
            options.headers['Content-Type'] = 'application/json';
            options.body = JSON.stringify(body);
          }
          const res = await fetch(base() + path, options);
          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch {
            data = text;
          }
          out.textContent = `[${res.status}] ${json(data)}`;
        } catch (e) {
          out.textContent = 'Error: ' + e.message;
        }
      }

      function openKakaoLogin() {
        window.location.href = base() + '/api/auth/kakao/backend';
      }

      async function getKakaoUrl() {
        await api('GET', '/api/auth/kakao/url');
      }

      async function logout() {
        await api('POST', '/api/auth/logout');
      }

      async function getWaitingRooms() {
        await api('GET', '/api/game/rooms');
      }

      async function createRoom() {
        const name = document.getElementById('roomName').value || 'í…ŒìŠ¤íŠ¸ë°©';
        await api('POST', '/api/game/rooms', { name, maxPlayers: 8 });
      }

      async function getRoom() {
        const id = document.getElementById('roomId').value;
        if (!id) {
          out.textContent = 'ë°© IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
          return;
        }
        await api('GET', '/api/game/rooms/' + id);
      }

      async function joinRoom() {
        const id = document.getElementById('roomId').value;
        if (!id) {
          out.textContent = 'ë°© IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
          return;
        }
        await api('POST', '/api/game/rooms/' + id + '/join');
      }

      async function leaveRoom() {
        const id = document.getElementById('roomId').value;
        if (!id) {
          out.textContent = 'ë°© IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
          return;
        }
        await api('POST', '/api/game/rooms/' + id + '/leave');
      }

      async function setReady() {
        const id = document.getElementById('roomId').value;
        if (!id) {
          out.textContent = 'ë°© IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
          return;
        }
        await api('PATCH', '/api/game/rooms/' + id + '/ready?ready=true');
      }

      async function startGame() {
        const id = document.getElementById('roomId').value;
        if (!id) {
          out.textContent = 'ë°© IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
          return;
        }
        await api('POST', '/api/game/rooms/' + id + '/start');
      }

      async function getNearbyMarkers() {
        const lat = document.getElementById('lat').value || 37.5665;
        const lng = document.getElementById('lng').value || 126.978;
        const radius = document.getElementById('radius').value || 0.5;
        await api(
          'GET',
          `/api/location/markers?lat=${lat}&lng=${lng}&radius=${radius}`,
        );
      }

      async function getRegions() {
        await api('GET', '/api/location/regions');
      }

      async function getMe() {
        await api('GET', '/api/user/me');
      }
    </script>
  </body>
</html>
